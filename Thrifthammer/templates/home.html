{% extends "base.html" %}

{% block title %}Warhammer Price Comparison — Find the Best Deals on 40K Kits{% endblock %}

{% block meta_description %}<meta name="description" content="ThriftHammer tracks Warhammer 40,000 prices across US retailers. Compare prices on Space Marines, Necrons, Orks and more — always find the cheapest deal before you buy.">{% endblock %}

{% block extra_head %}
<meta name="keywords" content="Warhammer 40K price comparison, cheap Warhammer, best price Warhammer 40000, Games Workshop deals, Warhammer discount, buy Warhammer online USA">
<meta property="og:title" content="ThriftHammer — Warhammer Price Tracker">
<meta property="og:description" content="Compare Warhammer 40,000 prices across US retailers. Find the cheapest deal on every kit, every day.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://www.thrifthammer.com/">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ThriftHammer — Warhammer Price Tracker">
<meta name="twitter:description" content="Compare Warhammer 40,000 prices across US retailers. Never overpay for plastic again.">
<link rel="canonical" href="https://www.thrifthammer.com/">
<style>
  /* Hero search autocomplete inherits global .hero-search-results styles */
  #hero-search-results { display: none; }
</style>
{% endblock %}

{% block content %}

{# ─── HERO ──────────────────────────────────────────────────────────────── #}
<section class="hero" aria-labelledby="hero-heading">
    <div class="container" style="position:relative;z-index:1;">

        <h1 id="hero-heading">
            Find the Best Deals on<br>
            <span style="color:var(--accent-gold-lt);">Warhammer Kits</span> Online
        </h1>
        <div class="hero-rule"></div>
        <p>
            We track prices across US retailers so you always know
            where to get the best deal. No more overpaying for plastic.
        </p>

        {# Hero search bar #}
        <div class="hero-search" role="search">
            <span class="hero-search-icon" aria-hidden="true"></span>
            <input
                type="text"
                id="hero-search-input"
                placeholder="Search kits, factions, SKUs…"
                autocomplete="off"
                aria-label="Search Warhammer products"
            >
            <div id="hero-search-results" class="hero-search-results" role="listbox" aria-label="Search suggestions"></div>
        </div>

        <div style="display:flex;gap:var(--sp-3);justify-content:center;flex-wrap:wrap;">
            <a href="{% url 'products:list' %}" class="btn btn-primary btn-lg">Browse All Products</a>
            <a href="{% url 'calculators:space_marines' %}" class="btn btn-secondary btn-lg">Army Calculator</a>
        </div>

        {# Hero stats bar #}
        <div class="hero-stats">
            <div class="hero-stat">
                <span class="hero-stat-value">{{ product_count_display }}</span>
                <span class="hero-stat-label">Kits tracked</span>
            </div>
            <div class="hero-stat">
                <span class="hero-stat-value">4</span>
                <span class="hero-stat-label">US Retailers</span>
            </div>
            <div class="hero-stat">
                <span class="hero-stat-value">Free</span>
                <span class="hero-stat-label">Always</span>
            </div>
        </div>

    </div>
</section>

{# ─── FEATURED DEALS ──────────────────────────────────────────────────── #}
{% if recent_drops %}
<section class="section" aria-labelledby="deals-heading">
    <div class="container">
        <div class="section-header" style="display:flex;align-items:flex-end;justify-content:space-between;flex-wrap:wrap;gap:var(--sp-4);">
            <div>
                <h2 id="deals-heading">Hot Deals</h2>
                <p>Top discounts right now across US retailers</p>
            </div>
            <a href="{% url 'products:list' %}?sort=price_asc" class="btn btn-ghost">View all deals →</a>
        </div>

        <div class="card-grid">
            {% for cp in recent_drops %}
            <a href="{% url 'products:detail' cp.product.slug %}" class="product-card">

                {% if cp.product.image_url %}
                <img
                    src="{{ cp.product.image_url }}"
                    alt="{{ cp.product.name }}"
                    class="product-card-img"
                    loading="lazy"
                >
                {% else %}
                <div class="product-card-img-placeholder" aria-hidden="true"></div>
                {% endif %}

                <div class="product-card-body">
                    <div class="product-card-name">{{ cp.product.name }}</div>

                    <div class="product-card-badges">
                        {% if cp.product.category %}
                        <span class="badge badge-default">{{ cp.product.category.name }}</span>
                        {% endif %}
                        {% if cp.product.faction %}
                        <span class="badge badge-purple">{{ cp.product.faction.name }}</span>
                        {% endif %}
                    </div>

                    <div class="product-card-pricing">
                        <div class="product-card-price-label">Best price at {{ cp.retailer.name }}</div>
                        <div class="product-card-price">${{ cp.price|floatformat:"2" }}</div>
                        {% if cp.product.msrp %}
                        <div style="display:flex;align-items:center;gap:var(--sp-2);flex-wrap:wrap;margin-top:var(--sp-1);">
                            <span class="product-card-msrp">RRP ${{ cp.product.msrp }}</span>
                            {% if cp.discount_pct and cp.discount_pct > 0 %}
                            <span class="badge badge-green">{{ cp.discount_pct }}% off</span>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>

            </a>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

{# ─── ARMY CALCULATOR CTA ─────────────────────────────────────────────── #}
<section class="section section-alt" aria-labelledby="calc-heading">
    <div class="container">
        <div class="calc-cta-grid">

            {# Left: copy #}
            <div>
                <span class="badge badge-gold" style="margin-bottom:var(--sp-4);">New Feature</span>
                <h2 id="calc-heading" style="font-size:clamp(1.5rem,4vw,2rem);margin-bottom:var(--sp-4);">
                    Plan Your Army.<br>
                    <span style="color:var(--accent-green);">See the Real Cost.</span>
                </h2>
                <p style="font-size:1rem;line-height:1.7;margin-bottom:var(--sp-6);color:var(--text-secondary);">
                    Build your Space Marine roster unit by unit, and instantly see
                    the best-value way to assemble your army across all tracked retailers.
                    Save big before you buy.
                </p>
                <div style="display:flex;gap:var(--sp-3);flex-wrap:wrap;">
                    <a href="{% url 'calculators:space_marines' %}" class="btn btn-primary btn-lg">Build My Army</a>
                    {% if user.is_authenticated %}
                    <a href="{% url 'calculators:my_armies' %}" class="btn btn-secondary">View Saved Armies</a>
                    {% else %}
                    <a href="{% url 'accounts:register' %}" class="btn btn-secondary">Sign Up Free</a>
                    {% endif %}
                </div>
            </div>

            {# Right: preview widget #}
            <div class="calc-cta-preview" aria-hidden="true">
                <div style="font-size:0.75rem;text-transform:uppercase;letter-spacing:0.08em;color:var(--text-muted);margin-bottom:var(--sp-4);">
                    Example: 2,000pt Space Marine List
                </div>
                <div class="calc-preview-row">
                    <span class="calc-preview-label">Intercessor Squad (x2)</span>
                    <span class="calc-preview-price">$72.00</span>
                </div>
                <div class="calc-preview-row">
                    <span class="calc-preview-label">Bladeguard Veterans</span>
                    <span class="calc-preview-price">$45.00</span>
                </div>
                <div class="calc-preview-row">
                    <span class="calc-preview-label">Repulsor Executioner</span>
                    <span class="calc-preview-price">$110.00</span>
                </div>
                <div class="calc-preview-row">
                    <span class="calc-preview-label">Captain in Phobos Armour</span>
                    <span class="calc-preview-price">$38.00</span>
                </div>
                <div class="calc-preview-total">
                    <span class="calc-preview-total-label">Total (best prices)</span>
                    <span class="calc-preview-total-price">$265.00</span>
                </div>
                <p style="font-size:0.72rem;color:var(--text-muted);margin-top:var(--sp-3);text-align:center;">
                    vs. $310+ at GW retail — save ~$45
                </p>
            </div>

        </div>
    </div>
</section>

{# ─── HOW IT WORKS ────────────────────────────────────────────────────── #}
<section class="section" aria-labelledby="how-heading">
    <div class="container">
        <div class="section-header" style="text-align:center;">
            <h2 id="how-heading">How ThriftHammer Works</h2>
            <p>Three steps to always getting the best price on your hobby</p>
        </div>

        <div class="steps-grid">

            <div class="step-card">
                <div class="step-number-large" aria-hidden="true">01</div>
                <h3>Search Your Kit</h3>
                <p>
                    Find any Warhammer 40,000, Age of Sigmar, Kill Team, or
                    paints kit from our catalogue of {{ product_count_display }} tracked products.
                </p>
            </div>

            <div class="step-card">
                <div class="step-number-large" aria-hidden="true">02</div>
                <h3>Compare Prices</h3>
                <p>
                    See live prices from Miniature Market, Noble Knight,
                    eBay, Amazon, and more — side by side.
                </p>
            </div>

            <div class="step-card">
                <div class="step-number-large" aria-hidden="true">03</div>
                <h3>Watch &amp; Save</h3>
                <p>
                    Add products to your watchlist with a target price.
                    We'll flag it when the price drops below your threshold.
                </p>
            </div>

        </div>
    </div>
</section>

{# Categories moved to sidebar on the browse page #}

{# ─── TRUST BAR ───────────────────────────────────────────────────────── #}
<section class="section" aria-label="Site statistics">
    <div class="container">
        <div class="trust-bar">
            <div class="trust-item">
                <span class="trust-value">{{ product_count_display }}</span>
                <span class="trust-label">Kits tracked</span>
            </div>
            <div class="trust-item">
                <span class="trust-value">4</span>
                <span class="trust-label">US retailers</span>
            </div>
            <div class="trust-item">
                <span class="trust-value">Free</span>
                <span class="trust-label">No account needed to browse</span>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
(function () {
    "use strict";
    var input    = document.getElementById("hero-search-input");
    var dropdown = document.getElementById("hero-search-results");
    if (!input || !dropdown) return;

    var timer;

    input.addEventListener("input", function () {
        clearTimeout(timer);
        var q = input.value.trim();
        if (q.length < 2) { dropdown.style.display = "none"; return; }
        timer = setTimeout(function () {
            fetch("{% url 'products:search_autocomplete' %}?q=" + encodeURIComponent(q))
                .then(function (r) { return r.json(); })
                .then(function (data) {
                    dropdown.innerHTML = "";
                    if (!data.results || !data.results.length) {
                        dropdown.style.display = "none";
                        return;
                    }
                    data.results.forEach(function (r) {
                        var a = document.createElement("a");
                        a.href = "/products/" + r.slug + "/";
                        var name = document.createElement("span");
                        name.textContent = r.name;
                        a.appendChild(name);
                        if (r.msrp) {
                            var price = document.createElement("span");
                            price.className = "ac-price";
                            price.textContent = "$" + parseFloat(r.msrp).toFixed(2);
                            a.appendChild(price);
                        }
                        dropdown.appendChild(a);
                    });
                    dropdown.style.display = "block";
                })
                .catch(function () { dropdown.style.display = "none"; });
        }, 200);
    });

    document.addEventListener("click", function (e) {
        if (!e.target.closest(".hero-search")) {
            dropdown.style.display = "none";
        }
    });

    input.addEventListener("keydown", function (e) {
        if (e.key === "Escape") { dropdown.style.display = "none"; }
        if (e.key === "ArrowDown") {
            var first = dropdown.querySelector("a");
            if (first) { e.preventDefault(); first.focus(); }
        }
        if (e.key === "Enter") {
            e.preventDefault();
            window.location.href = "{% url 'products:list' %}?q=" + encodeURIComponent(input.value.trim());
        }
    });
})();
</script>
{% endblock %}
